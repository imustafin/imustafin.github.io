<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <link
      rel="alternate"
      hreflang="en"
      href="https://imustafin.tatar/projects/pbdoom"
    />

    <link
      rel="alternate"
      hreflang="ru"
      href="https://imustafin.tatar/ru/%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D1%8B/pbdoom"
    />

    <link
      rel="alternate"
      hreflang="tt"
      href="https://imustafin.tatar/tt/%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%BB%D0%B0%D1%80/pbdoom"
    />

    <link
      rel="alternate"
      type="application/atom+xml"
      href="https://imustafin.tatar/feed.xml"
      title="Posts in English"
    />
    <link
      rel="alternate"
      type="application/atom+xml"
      href="https://imustafin.tatar/feed-multilang.xml"
      title="Posts in all languages"
    />

    <!-- Begin Jekyll SEO tag v2.8.0 -->
    <title>PBDoom | imustafin.tatar</title>
    <meta name="generator" content="Jekyll v4.3.3" />
    <meta property="og:title" content="PBDoom" />
    <meta name="author" content="Ilgiz Mustafin" />
    <meta property="og:locale" content="en" />
    <meta
      name="description"
      content="PBDoom is a port of the Doom (1993) videogame for PocketBook eInk devices. Downloads are on the official website of PBDoom."
    />
    <meta
      property="og:description"
      content="PBDoom is a port of the Doom (1993) videogame for PocketBook eInk devices. Downloads are on the official website of PBDoom."
    />
    <meta
      property="twitter:description"
      content="PBDoom is a port of the Doom (1993) videogame for PocketBook eInk devices. Downloads are on the official website of PBDoom."
    />
    <link rel="canonical" href="https://imustafin.tatar/projects/pbdoom" />
    <meta property="og:url" content="https://imustafin.tatar/projects/pbdoom" />
    <meta property="og:site_name" content="imustafin.tatar" />
    <meta property="og:type" content="article" />
    <meta
      property="article:published_time"
      content="2023-02-26T00:00:00+00:00"
    />
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="PBDoom" />
    <!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#157878" />
    <link rel="stylesheet" href="/assets/css/main.css" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="apple-mobile-web-app-title" content="imustafin.tatar" />
    <meta name="application-name" content="imustafin.tatar" />
    <meta name="msapplication-TileColor" content="#00aba9" />
    <meta name="theme-color" content="#ffffff" />
  </head>
  <body class="text-tcolor" vocab="https://schema.org/" typeof="WebPage">
    <div class="min-h-svh flex flex-col">
      <section
        class="bg-[linear-gradient(120deg,var(--tw-gradient-stops))] from-[#155799] to-ghaze-600 text-white text-center"
      >
        <span class="text-l sm:text-xl font-serif font-semibold mt-2 mb-2 mx-2">
          <a href="/"> Ilgiz Mustafin's personal website </a>
        </span>

        <div class="flex flex-col lg:flex-row">
          <div class="flex-1"></div>

          <ul class="flex-[2] mb-2 space-x-2">
            <li class="inline"><a href="/">Home</a></li>

            <li class="inline"><a href="/blog/">Blog</a></li>

            <li class="inline"><a href="/projects/">Projects</a></li>

            <li class="inline"><a href="/ilgiz">About</a></li>
          </ul>

          <ul class="flex-1 space-x-2 mb-2">
            <li class="inline">
              <a lang="en" href="/projects/pbdoom">English</a>
            </li>

            <li class="inline">
              <a
                lang="ru"
                href="/ru/%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D1%8B/pbdoom"
                >Русский</a
              >
            </li>

            <li class="inline">
              <a
                lang="tt"
                href="/tt/%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%BB%D0%B0%D1%80/pbdoom"
                >Татарча</a
              >
            </li>
          </ul>
        </div>
      </section>

      <div class="flex-1 p-2 md:pt-4">
        <section class="max-w-prose mx-auto">
          <nav class="mb-4">
            <ol
              property="breadcrumb"
              class="breadcrumbs"
              vocab="https://schema.org/"
              typeof="BreadcrumbList"
            >
              <li
                class="inline-block"
                property="itemListElement"
                typeof="ListItem"
              >
                <a property="item" typeof="WebPage" href="/" class="vlink">
                  <meta
                    property="name"
                    content="Ilgiz Mustafin: PhD Student in Software Engineering"
                  />
                  <span property="alternateName">Main</span>
                </a>

                <meta property="position" content="1" />
              </li>

              <li
                class="inline-block text-[#afbbc4] before:content-['/']"
                property="itemListElement"
                typeof="ListItem"
              >
                <a
                  property="item"
                  typeof="WebPage"
                  href="/projects/"
                  class="vlink"
                >
                  <span property="name">Projects</span>
                </a>

                <meta property="position" content="2" />
              </li>

              <li
                class="inline-block text-[#afbbc4] before:content-['/']"
                property="itemListElement"
                typeof="ListItem"
              >
                <span
                  property="item"
                  typeof="WebPage"
                  resource="/projects/pbdoom"
                  class="text-tcolor"
                >
                  <span property="name">PBDoom</span>
                </span>

                <meta property="position" content="3" />
              </li>
            </ol>
          </nav>

          <article
            class="max-w-prose"
            itemscope
            itemtype="http://schema.org/BlogPosting"
          >
            <header>
              <div class="prose">
                <h1 itemprop="name headline">PBDoom</h1>
              </div>
              <div class="italic">
                <time
                  class="inline-block mr-4"
                  datetime="2023-02-26T00:00:00+00:00"
                  itemprop="datePublished"
                >
                  26 February 2023
                </time>

                <span class="inline-block">
                  Last modified:
                  <time
                    datetime="2023-02-28T00:00:00+00:00"
                    itemprop="dateModified"
                  >
                    28 February 2023
                  </time>
                </span>
              </div>
            </header>

            <div itemprop="articleBody" class="prose mt-4">
              <p>
                PBDoom is a port of the Doom (1993) videogame for PocketBook
                eInk devices. Downloads are on
                <a href="https://pbdoom.imustafin.tatar/"
                  >the official website of PBDoom</a
                >.
              </p>

              <figure class="max-w-xs mx-auto">
                <img
                  src="/assets/pbdoom_inch_6_display.png"
                  alt="PBDoom on a 6 inch display"
                />
                <figcaption class="text-center">
                  PBDoom on a 6" display
                </figcaption>
              </figure>

              <p>
                PBDoom is based on
                <a href="https://www.libsdl.org/projects/doom/"
                  >Sam Lantinga’s SDL Doom</a
                >. SDL drawing functions were replaced with PocketBook SDK’s
                <code class="language-plaintext highlighter-rouge"
                  >inkview</code
                >
                library functions. SDL sound functions were completely removed
                from the code for now (not many PocketBooks have speakers
                nowadays, headphones usually can be connected however).
              </p>

              <p>
                The development of PBDoom started in March of 2022. The first
                public release was published in January of 2023.
              </p>

              <p>
                Source code is
                <a href="https://github.com/imustafin/pbdoom"
                  >available on GitHub</a
                >.
              </p>

              <h2 id="why">Why?</h2>
              <p>This project serves several purposes:</p>
              <ol>
                <li>
                  Produce an example of an action game on an eInk reader device
                </li>
                <li>One more custom application for PocketBook</li>
                <li>
                  Gather experience of using the
                  <code class="language-plaintext highlighter-rouge"
                    >inkview</code
                  >
                  library
                </li>
              </ol>

              <p>
                Porting Doom was not a big project. SDL Doom runs on Linux and
                (some) PocketBooks run Linux. Reworking the main graphics output
                function to use
                <code class="language-plaintext highlighter-rouge">inkview</code
                >’s
                <code class="language-plaintext highlighter-rouge"
                  >FillArea</code
                >
                (fill a rectangle with a color) function instead of writing
                pixel data to an SDL surface is easy.
              </p>

              <p>
                However, due to some limitations of the eInk technology (low
                refresh rate, lack of color on some devices) some additional
                work needs to be done on the video output part. In this project
                we explore what needs to be done and what is possible.
              </p>

              <p>
                Also this project has introduced me to
                <a href="https://cmake.org/">CMake</a>.
              </p>

              <h2 id="can-pocketbook-run-doom">Can PocketBook run Doom?</h2>
              <p>
                Yes it can but this is not big news. The developers working on
                PocketBook released a video of Doom running on a PocketBook 360
                Plus back in 2011.
              </p>
              <figure class="mx-auto">
                <iframe
                  class="aspect-video mx-auto w-full md:w-[600px]"
                  src="https://www.youtube-nocookie.com/embed/QOPZrVsCEHg"
                  title="YouTube video player"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen=""
                ></iframe>
                <figcaption class="text-center">
                  Doom 2 on PocketBook 360 Plus
                </figcaption>
              </figure>

              <p>
                This version was produced “during a lunch break” (<a
                  href="https://www.the-ebook.org/forum/viewtopic.php?p=639725"
                  >original message</a
                >,
                <a
                  href="https://web.archive.org/web/20110811143945/https://www.the-ebook.org/forum/viewtopic.php?p=639725"
                  >archived message</a
                >) and was (to my knowledge) never released to the public.
              </p>

              <p>
                So, PBDoom can finally close the gap and serve as a publicly
                available Doom for PocketBook, (some people) needed so much.
              </p>

              <h2 id="image-dithering-optimization-for-eink">
                Image dithering: optimization for eInk
              </h2>
              <p>
                As noted before, eInk displays have low refresh rate. This
                requires some workarounds for a comfortable playing experience.
              </p>

              <p>
                Some eInk displays have multiple update modes. In some modes the
                update time depends on the required changes to the displayed
                image. For example, replacing a full-white region with a
                full-black region can be faster than working with shades of
                grey.
              </p>

              <p>
                Using this quality, we can increase the game refresh rate while
                sacrificing some of the image quality.
              </p>

              <p>
                The official
                <code class="language-plaintext highlighter-rouge"
                  >inkview</code
                >
                documentation suggests dithering the image doen to only two
                color levels for quick updates (<a
                  href="https://github.com/pocketbook-free/InkViewDoc/blob/master/PocketBookSDK.pdf"
                  >page 12</a
                >):
              </p>

              <blockquote>
                <p>
                  Call [<code class="language-plaintext highlighter-rouge"
                    >DitherArea</code
                  >] with
                  <code class="language-plaintext highlighter-rouge"
                    >levels=2</code
                  >
                  and
                  <code class="language-plaintext highlighter-rouge"
                    >method=DITHER_THRESHOLD</code
                  >
                  to have image that can be quickly updated e.g. for menus,
                  lists and selections.
                </p>
              </blockquote>

              <p>Formatting by me.</p>

              <p>
                The
                <code class="language-plaintext highlighter-rouge"
                  >inkview</code
                >
                library provides several functions to dither screen output
                (<code class="language-plaintext highlighter-rouge"
                  >DitherArea</code
                >
                and others).
              </p>

              <p>
                We also can manipulate the colors to change brightness, contrast
                and do gamma correction to fine tune the output, before
                dithering.
              </p>

              <h2 id="post-changelog">Post changelog</h2>
              <ul>
                <li>
                  28 February 2023 — add the missing word <em>never</em> to
                  specify that the port by PocketBook was
                  <em>never</em> released. Also cite
                  <code class="language-plaintext highlighter-rouge"
                    >inkview</code
                  >
                  documentation for dithering tips.
                </li>
              </ul>
            </div>
          </article>
        </section>
      </div>

      <footer
        class="bg-[linear-gradient(120deg,var(--tw-gradient-stops))] from-[#155799] to-ghaze-600 text-white mt-4 pt-4 pb-4"
      >
        <ul class="space-x-4 flex justify-center">
          <li class="inline">
            <a lang="en" href="/projects/pbdoom">English</a>
          </li>

          <li class="inline">
            <a
              lang="ru"
              href="/ru/%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D1%8B/pbdoom"
              >Русский</a
            >
          </li>

          <li class="inline">
            <a
              lang="tt"
              href="/tt/%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%BB%D0%B0%D1%80/pbdoom"
              >Татарча</a
            >
          </li>
        </ul>
      </footer>
    </div>
  </body>
</html>
